---
title: "Basic R tutorial"
date: February 22, 2024
output: pdf_document
editor_options: 
  chunk_output_type: console
---

# Problem 3: Learning Bayesian networks from protein data

## Preparation to run the code

Setting seed for reproducibility and loading packages.

```{r}
set.seed(42)
library("GGally")
library("BiDAG")
```

## Loading data

```{r}
data <- read.table("2005_sachs_2_cd3cd28icam2_log_std.csv", sep=",", header=TRUE)
```

## Variables and observations

```{r}
num_variables <- ncol(data)
num_observations <- nrow(data)
```

## Visualisation of transformed data

TODO: must resize the plot

```{r}
pair_plot <- ggpairs(data, progress=FALSE)
pair_plot
```

TODO: execute the following routine with different parameters (10 times for each change of parameter)

TODO: include possibility of parallelization

## Splitting data

```{r}
train_size <- ceiling(num_observations*0.8)
indices <- 1:num_observations
indices <- sample(length(indices))
train_indices <- indices[1:train_size]
test_indices <- indices[(train_size+1):(length(indices))]
```

```{r}
train_data <- data[row.names(data) %in% 1:train_size, ]
test_data <- data[row.names(data) %in% (train_size+1):nrow(data), ]
```

```{r}
# Checking if there is no overlap
if(length(unique(c(train_indices, test_indices))) == length(c(train_indices, test_indices))) {
  print("No overlap")
}
```

```{r}
init_score_par <- scoreparameters("bge", train_data)
```

```{r}
learnt_BN <- iterativeMCMC(init_score_par)
```

```{r}
test_score_par <- scoreparameters("bge", test_data)
test_score <- scoreagainstDAG(test_score_par, learnt_BN$DAG)
```

```{r}
mean(test_score)
```

## Render this .rmd into a pdf

```{r, eval=FALSE}
library(rmarkdown)
render("1/1.Rmd", pdf_document(TRUE), "1.pdf") # TRUE adds table of content
```
