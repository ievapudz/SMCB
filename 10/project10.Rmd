---
title: "Project 10"
output:
  pdf_document: 
    extra_dependencies: ['amsmath']
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

# Problem 29

```{r}
library(caret)
library(glmnet)
library(pROC)
```

## Loading data

```{r}
load(file='yeastStorey.rda')
```

```{r}
print(nrow(data))
print(ncol(data))
```

```{r}
head(data)
```

## Shuffling data (splitting into training and testing)

```{r}
set.seed(42)
trainIndex <- createDataPartition(data$Marker, p=0.7, list=FALSE, times=1)
trainData <- data[trainIndex,]
testData <- data[-trainIndex,]
```

```{r}
trainData
```

```{r}
testData
```

## Cross-validation of elastic-net model

```{r}
x <- trainData[, !(names(trainData) %in% c("Marker"))]
x <- as.matrix(x)
y <- trainData$Marker
```

```{r}
foldid <- sample(1:10, size=length(y), replace=TRUE)
alphas <- seq(0, 1, by=0.1)

elasticNetCVAlpha <- function(alpha) {
  cv.glmnet(x, y, family="binomial", alpha=alpha, nfolds=10, foldid=foldid)
}

resultsCV <- lapply(alphas, elasticNetCVAlpha)
```

```{r}
minMeanCVMIdx <- 1
minMeanCVM <- mean(resultsCV[[1]]$cvm)
for(i in 1:11) { 
  if(minMeanCVM > mean(resultsCV[[i]]$cvm)) { minMeanCVM <- mean(resultsCV[[i]]$cvm); minMeanCVMIdx <- i}
  print(paste0("alpha=", alphas[i], "; error=", mean(resultsCV[[i]]$cvm))) 
}
```
### Finding optimal alpha

$\alpha$ with which mean of mean cross-validated error is the smallest: $\alpha=$.
This alpha will be considered as optimal.

```{r}
print(paste("Min. mean of mean cross-validated error:", minMeanCVM))
optimalAlphaIdx <- minMeanCVMIdx
```

### Plotting mean cross-validated error

Cross-validated error function is binomial deviance.

```{r}
plot(resultsCV[[optimalAlphaIdx]], ylab="cross-validated error")
```

### Plotting trace curve of coefficients

```{r}
plot(resultsCV[[optimalAlphaIdx]]$glmnet.fit, "lambda")
```

### Picking optimal lambda

```{r}
optimalLambdaIdx <- which.min(resultsCV[[optimalAlphaIdx]]$cvm)
print(paste("Optimal lambda:", resultsCV[[optimalAlphaIdx]]$lambda[[optimalLambdaIdx]]))
```

## Fitting model

## Testing model

```{r, eval=FALSE}
library(rmarkdown)
render("project10.Rmd", pdf_document(TRUE), "Indilewitsch_Toidze_Houhamdi_Pudziuvelyte_Project10.pdf")
```
